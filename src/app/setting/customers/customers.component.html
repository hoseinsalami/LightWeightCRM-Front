<div class="p-4 mx-auto max-w-60rem ">
<!--  <div class="text-left mb-3">-->
<!--    <button pButton pRipple  label="جدید" icon="pi pi-plus" class="p-button-success p-mr-2"-->
<!--            routerLink="new"></button>-->
<!--  </div>-->
  <p-table #dt
           [rows]="20"
           [value]="many?many:[]"
           [paginator]="true"
           [rowHover]="true"
           dataKey="id"
           [showCurrentPageReport]="true"
           [lazy]="true"
           (onLazyLoad)="lazyLoadData(construct, dt,$event,'/list')"
           [totalRecords]="totalRecords? totalRecords : 0"
           [loading]="tableLoading"
           [rowsPerPageOptions]="[10,25,50,100,200,500]"
           currentPageReportTemplate=" از {first}  تا {last} از مجموع {totalRecords} نتیجه"
           responsiveLayout="scroll"
           styleClass="p-datatable-responsive-demo p-datatable-sm overflow-x-hidden"
           paginatorStyleClass="hidden"
           class="overflow-x-hidden"
           stateStorage="local"
           stateKey="customerTable"
           (onFilter)="onFilterTable($event)"
           (onStateRestore)="onStateRestore($event)">

    <!--        {first} تا {last} از  {totalRecords}-->

    <ng-template pTemplate="header">
      <tr>
        <td colspan="200">
          <p-panel [toggleable]="true" class="surface-300" [collapsed]="true">
            <ng-template pTemplate="header">
              <p class="m-0"> فیلتر ها و مرتب سازی</p>
              <button *ngIf="showTableHaveFilter" pButton label="حذف فیلتر ها" class="p-button-outlined mx-2" icon="pi pi-filter-slash" (click)="clear(dt);"></button>

            </ng-template>
            <div class="flex flex-wrap col-12">

              <div class="col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2" pSortableColumn="name">
                <p-columnFilter type="text" field="name" display="menu" [showClearButton]="false"></p-columnFilter>
                نام
                <p-sortIcon field="name"></p-sortIcon>
              </div>
              <div class="col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2" pSortableColumn="family">
                <p-columnFilter type="text" field="family" display="menu" [showClearButton]="false"></p-columnFilter>
                نام خانوادگی
                <p-sortIcon field="family"></p-sortIcon>
              </div>
              <div class="col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2" pSortableColumn="companyName">
                <p-columnFilter type="text" field="companyName" display="menu" [showClearButton]="false"></p-columnFilter>
                شرکت
                <p-sortIcon field="companyName"></p-sortIcon>
              </div>
              <div class="col-12 sm:col-6 md:col-4 lg:col-3 xl:col-2">
                <p-columnFilter
                  field="tags"
                  [showMatchModes]="false"
                  [showOperator]="false"
                  [showAddButton]="false"
                  [showButtons]="false"
                  matchMode="equals"
                  display="menu"
                  class="ml-auto">
                  <ng-template pTemplate="filter">
                    <div style="min-width:220px">
                      <p-dropdown
                        optionLabel="title"
                        optionValue="id"
                        [(ngModel)]="tagId"
                        [options]="listOfTag"
                        placeholder="فیلتر براساس برچسب">
                        <ng-template let-option pTemplate="item">
                          <div class="flex align-items-center gap-2">
                            <span class="w-1rem h-1rem border-1 border-solid border-round-3xl block" [style]="{background:option.color}"></span>
                            {{option.title}}
                          </div>
                        </ng-template>
                      </p-dropdown>
                      <div class="flex gap-2 mt-2">
                        <button
                          pButton
                          label="اعمال"
                          class="text-sm"
                          (click)="changeCustomerByTag($event,tagId)"
                        ></button>
                        <button
                          pButton
                          label="حذف فیلتر"
                          class="p-button-outlined text-sm"
                          (click)="removeFilterTag($event)"
                        ></button>
                      </div>
                    </div>
                  </ng-template>
                </p-columnFilter>
                برچسب
              </div>

            </div>
          </p-panel>
        </td>
      </tr>

    </ng-template>

    <ng-template pTemplate="body" let-object>

    </ng-template>

  </p-table>


  <div class="grid mt-1">
    <div class="col-12 md:col-3 xl:col-2" routerLink="new"
         pTooltip="مشتری جدید" tooltipPosition="top">
      <div class="h-full relative flex justify-content-center align-items-center p-4 shadow-1 hover:shadow-2 cursor-pointer border-round-2xl border-1 border-solid border-dashed border-green-500 text-green-500 hover:bg-green-100">
          <i class="pi pi-plus " style="font-size:40px; opacity: 0.3;"></i>
      </div>
    </div>

    <div class="col-12 md:col-3 xl:col-2" *ngFor="let object of many" (click)="openDetails(object.id)">
      <div class="h-full relative flex flex-column justify-content-between border-1 surface-border p-4 border-round-2xl shadow-1 hover:shadow-2 bg-white cursor-pointer">
        <!-- Top Section -->
        <div>
          <h2 class="flex align-items-center justify-content-between text-xl font-bold text-900 white-space-nowrap overflow-hidden text-overflow-ellipsis">
            <div class="flex align-items-center gap-3 text-sm">
              <div class="flex-shrink-0 border-circle overflow-hidden" style="width:2rem; height:2rem;">
                <img src="assets/images/avatar-user.png" alt="avatar" class="w-full h-full"/>
              </div>
              <div class="flex align-items-center gap-2">
                <span class="font-medium text-900">{{ object.name }} {{ object.family }}</span>
                <span class="text-green-500 text-xs font-bold">(مشتری)</span>
              </div>
            </div>


            <span class="pi pi-cog" pTooltip="اسناد" tooltipPosition="top" (click)="navigateToDocument(object)"></span>
          </h2>
          <p class="text-sm text-600 mt-2 ">
            <span class="pi pi pi-building text-base text-gray-400 ml-2"></span>
            {{ object.companyName }}
          </p>

          <div class="flex align-items-center gap-2 mt-3 text-700" *ngIf="object.customerPhones?.length > 0">
            <span class="material-symbols-outlined text-sm cursor-pointer" (click)="showCustomerPhone($event, object.customerPhones, phonePanel)">
              <i class="text-lg pi pi-phone text-green-500"></i>
            </span>
            <span class="text-sm">{{ object.customerPhones[0].phoneNumber  }}</span>
            <p-overlayPanel [style]="{width:'250px'}" #phonePanel [dismissable]="true">
              <div class="grid">
                <ng-container *ngFor="let item of customerPhones; let last=last">
                  <div class="col-12 flex justify-content-between">
                    <label class="text-color-secondary">
                      {{ item.title }}
                    </label>
                    <label class="text-900">
                      {{ item.phoneNumber }}
                      <i class="pi pi-copy text-purple-500 cursor-pointer mx-2" pTooltip="کپی" tooltipPosition="top"
                         (click)="copyPhone(item.phoneNumber)"></i>
                      <i class="pi pi-envelope text-pink-500 cursor-pointer" pTooltip="ارسال پیامک" tooltipPosition="top"
                         (click)="openDialogSms(object,item)"></i>
                    </label>
                  </div>
                  <div class="col-12" *ngIf="!last"><p-divider type="solid" [style]="{'border-top':'1px solid #fbf3f3',}"/></div>
                </ng-container>
              </div>
            </p-overlayPanel>
          </div>
        </div>

        <!-- Tags Section -->
        <div
          (mousedown)="startDrag($event); $event.stopPropagation()"
          (mousemove)="onDrag($event); $event.stopPropagation()"
          (mouseup)="endDrag($event); $event.stopPropagation()"
          (mouseleave)="endDrag($event); $event.stopPropagation()"
          class="tags-scroll-container mt-3 border-top-1 surface-border pt-3 h-full">
            <span *ngFor="let tag of object.tags"
                  class="inline-flex align-items-center border-round px-2 py-1 text-xs font-medium text-white white-space-nowrap cursor-pointer"
                  [style]="{background: tag.color}">{{tag.title}}</span>
        </div>
      </div>
    </div>
    <div class="col-12">
      <p-paginator
        [style]="{background:'#f7f7f7'}"
        (onPageChange)="onPageChange($event)"
        [first]="lastEvent.first"
        [rows]="lastEvent.rows"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="[20, 40, 60, 80, 100]" />
    </div>

  </div>

  <!--************************** begin SendMessageForCustomer modal *************************************-->
  <p-dialog
    [styleClass]="'modal-small'"
    [style]="{direction:'rtl'}"
    [(visible)]="showDialogSms"
    [appendTo]="'body'"
    [header]="'ارسال پیام به مشتری' "
    [modal]="true">

    <div class="grid">
      <div class="col-12">
        <div class="flex flex-column flex-1">
          <label class="text-sm">پیام</label>
          <textarea
            rows="5"
            cols="30"
            pInputTextarea
            [(ngModel)]="dataMessage.message"
            placeholder="متن پیام را وارد نمایید">
        </textarea>
        </div>
      </div>

    </div>

    <ng-template pTemplate="footer">

      <button
        pButton
        pRipple
        label="تایید"
        class="p-button-success p-mr-2"
        (click)="onSendMessage()"
      ></button>

      <button
        pButton
        pRipple
        label="انصراف"
        class="p-button-danger p-mr-2"
        (click)="this.showDialogSms = false"
      ></button>


    </ng-template>

  </p-dialog>
  <!--************************** end SendMessageForCustomer modal *************************************-->

</div>
