<div class="p-card mx-auto max-w-60rem">
  <div class="grid">
    <div class="col-12">

      <p-tabView (onChange)="onTabChange($event)">

        <p-tabPanel *ngFor="let doc of documents">

          <ng-template pTemplate="header" >
            <i class="ml-2 pi pi-book"></i>
            <span>{{doc.title}}</span>
          </ng-template>

          <p-toolbar styleClass="p-mb-4">
            <ng-template pTemplate="left">
              <button pButton pRipple  label="جدید" icon="pi pi-plus" class="p-button-success p-mr-2" (click)="onShowDialog(doc)"></button>
            </ng-template>
          </p-toolbar>

          <div class="grid mt-2">
<!--            <ng-container *ngFor="let item of many.items">-->
              <div class="col-12 p-card shadow-none p-4 border-gray-200 border-1 flex align-items-center justify-content-between mb-2" *ngFor="let item of many.items; let i=index">
                <div class="flex align-items-center gap-2" >
                  <span class="text-sm">{{ i +1 }}#</span>
                </div>
                <ng-container *ngFor="let prop of item.propertiesValue">
                    <div class="flex align-items-center gap-2" *ngIf="prop.property.propertyType === propertyTypeEnum.Number && prop.property.showInList">
                      <span class="text-sm">{{prop.property.title}}</span>
                      <span class="text-sm text-900 font-semibold">{{prop.value}}</span>
                    </div>

                    <div class="flex align-items-center gap-2"
                         *ngIf="(prop.property.propertyType === propertyTypeEnum.ShortString || prop.property.propertyType === propertyTypeEnum.LongString) && prop.property.showInList">
                      <span>{{prop.property.title}}</span>
                      <span class="text-sm text-900 font-semibold">{{prop.value }}</span>
                    </div>

                    <div class="flex align-items-center gap-2"
                         *ngIf="prop.property.propertyType === propertyTypeEnum.SingleSelect && prop.property.showInList">
                      <span>{{prop.property.title}}</span>
                      <span class="text-sm text-900 font-semibold">{{ prop.value.value }}</span>
                    </div>
                  <div class="flex align-items-center gap-2"
                         *ngIf="prop.property.propertyType === propertyTypeEnum.MultiSelect && prop.property.showInList">
                      <span>{{prop.property.title}}</span>
                      <span class="text-sm text-900 font-semibold" *ngFor="let val of prop.value; let last=last">{{ val.value }}<span *ngIf="!last">، </span></span>
                    </div>

                    <div class="flex align-items-center gap-2"
                         *ngIf="prop.property.propertyType === propertyTypeEnum.Bool">
                      <span>{{prop.property.title}}</span>
                      <span class="text-sm text-900 font-semibold">{{prop.value }}</span>
                    </div>

                    <div class="flex align-items-center gap-2" *ngIf="prop.property.propertyType === propertyTypeEnum.Date && prop.property.showInList">
                      <span>{{prop.property.title}}</span>
                      <span class="text-sm text-900 font-semibold">{{prop.value | jalaliDate:'date'}}</span>
                    </div>

                  <div class="flex align-items-center gap-2" *ngIf="prop.property.propertyType === propertyTypeEnum.Document && prop.property.showInList">
                    <span>{{prop.property.title}}</span>
                    <span class="text-sm text-900 font-semibold cursor-pointer">{{prop.value }}</span>
                  </div>

                </ng-container>

                <div class="flex align-items-center gap-2">
                  <button class="mx-3 p-button-success"
                          pTooltip="ویرایش" tooltipPosition="top"
                          pButton icon="pi pi-file-edit mx-2"
                          (click)="detailDocumentInstance(item.id, doc.id)"></button>

                  <button (click)="deleteDocumentInstance(item.id)" pButton
                          pTooltip="حذف" tooltipPosition="top"
                          class="p-button-danger" icon="pi pi-trash mx-2"></button>

                </div>
              </div>
<!--            </ng-container>-->

          </div>

          <p-paginator
            class="mt-3 flex justify-content-center"
            (onPageChange)="onPageChange($event)"
            [first]="pagination.from"
            [rows]="pagination.rows"
            [totalRecords]="totalRecords || 0"
            [rowsPerPageOptions]="[20, 30, 50, 100]">
          </p-paginator>

        </p-tabPanel>

      </p-tabView>

    </div>

    <div class="col-12"></div>
  </div>
</div>


<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl', 'min-height':'500px'}"
  [(visible)]="showDialog"
  [appendTo]="'body'"
  [header]="isEditMode ? ' ویرایش ' + docTitle : docTitle + ' جدید '"
  [modal]="true"
  [closable]="false">

  <div class="grid" >
    <ng-container *ngFor="let prop of currentDocument; let i = index; let first = first">
      <div class="col-12 md:col-6" >

        <div class="form-group" >
          <label class="text-sm">{{prop.title}}</label>

          <div class="field" *ngIf="prop.propertyType == propertyTypeEnum.Number">
            <input
              pInputText
              type="text"
              id="defaultValue"
              name="defaultValue"
              class="p-fieldset w-full"
              placeholder="مقدار پیشفرض وارد نمایید"
              [(ngModel)]="prop.defaultValue"
              [pKeyFilter]="'int'">
          </div>

          <div class="field" *ngIf="prop.propertyType == propertyTypeEnum.SingleSelect && hasTitleInParameters">
            <p-dropdown [style]="{'width':'100%'}"
                        name="propertyType"
                        class="w-full"
                        placeholder ="انتخاب ویژگی"
                        scrollHeight="250px"
                        display="chip"
                        optionLabel="value"
                        optionValue="id"
                        appendTo="body"
                        [showClear]="true"
                        [(ngModel)]="prop.defaultValue"
                        [options]="getParameters(prop)"></p-dropdown>
          </div>

          <div class="field" *ngIf="prop.propertyType == propertyTypeEnum.MultiSelect && hasTitleInParameters">
            <p-multiSelect
              [styleClass]="'clear-icon'"
              [options]="getParameters(prop)"
              [(ngModel)]="prop.value"
              optionLabel="value"
              optionValue="id"
              class="mt-2"
              display="chip"
              appendTo="body"
              [maxSelectedLabels]="20"
              [style]="{'width':'100%'}"
              placeholder="انتخاب ویژگی">
            </p-multiSelect>
          </div>

          <div class="field" *ngIf="prop.propertyType === propertyTypeEnum.ShortString || prop.propertyType === propertyTypeEnum.LongString">
            <input
              pInputText
              type="text"
              id="SLDefaultValue"
              name="SLDefaultValue"
              class="p-fieldset w-full"
              placeholder="مقدار پیشفرض وارد نمایید"
              [(ngModel)]="prop.defaultValue ">
          </div>

          <div class="field relative" *ngIf="prop.propertyType == propertyTypeEnum.Date">
            <ng-persian-datepicker #datepicker
              [dateInitValue]="false"
              [uiIsVisible]="false"
              [style]="{'width':'220px'}"
              (dateOnSelect)="selectStartDate($event)"
              (dateOnInit)="initialStartDatePicker($event)"
              [dateGregorianFormat]="'YYYY-MM-DD '"
              [dateFormat]="'YYYY-MM-DD '">
              <input [formControl]="startDateTimeControl" id="startDate" name="startDate" class="font-bold w-full" pInputText type="text" autocomplete="off"/>
            </ng-persian-datepicker>
          </div>

          <div class="field" *ngIf="prop.propertyType == propertyTypeEnum.Document">
            <p-dropdown [style]="{'width':'100%'}" class="w-full"
                        placeholder ="انتخاب نمونه سند" appendTo="body"
                        optionLabel="title" optionValue="value"
                        [options]="instanceCustomer"
                        [(ngModel)]="prop.value"></p-dropdown>
          </div>

        </div>


      </div>
    </ng-container>
  </div>

  <ng-template pTemplate="footer">

    <button pButton pRipple label="تایید"
      class="p-button-success button p-mr-2"
      (click)="onSave()"></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="showDialog = false"
    ></button>

  </ng-template>

</p-dialog>
