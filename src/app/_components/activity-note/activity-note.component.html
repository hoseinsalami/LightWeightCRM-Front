<div class="grid" >
  <div class="col-12">

    <div class="flex justify-content-center">

      <div class="flex gap-3 p-card p-1 mt-3 bg-white">
        <!--            <span (click)="setActive('all')" [class.active]="activeItem === 'all'" class="cursor-pointer px-3">همه</span>-->
        <button pButton class="border-0 bg-white text-900 hover:bg-yellow-200" (click)="setActive('activities')" [class]="{ 'activePanel' : activeItem === 'activities'}">
          فعالیت ها
          <p-badge styleClass="text-xs mr-2" [value]="workItem?.activityCount ? workItem?.activityCount : 0" severity="success" />
        </button>
        <button pButton class="border-0 bg-white text-900 hover:bg-yellow-200" (click)="setActive('notes')" [class]="{'activePanel' : activeItem === 'notes'}" >
          یادداشت ها
          <p-badge styleClass="text-xs mr-2" [value]="workItem?.noteCount ? workItem?.noteCount : 0" severity="success" />
        </button>
        <!--            <button pButton class="border-0 bg-white text-900 hover:bg-yellow-200" (click)="setActive('sendMessage')" [class]="{'activePanel' : activeItem === 'sendMessage'}" >پیام های ارسالی</button>-->
        <button pButton class="border-0 bg-white text-900 hover:bg-yellow-200" *ngIf="workItemId || ticketId"
                (click)="setActive('changeLog')" [class]="{'activePanel' : activeItem === 'changeLog'}">تاریخچه تغییرات</button>
      </div>

    </div>
    <div class="grid" *ngIf="activeItem == 'activities' || activeItem == 'notes'">
      <div class="col-12">
        <div class="flex justify-content-center align-items-center gap-3 mt-2">

          <span class="m-0 text-white px-5 py-2 font-light border-round text-sm" style="background: #808080">فعالیت های برنامه ریزی شده</span>
          <button *ngIf="activeItem === 'notes' "
                  pButton
                  class="p-button-success p-2"
                  (click)="modalNewNote('new')">
            یادداشت جدید
          </button>

          <button *ngIf="activeItem === 'activities' "
                  pButton
                  class="p-button-success p-2"
                  (click)="modalNewActivity('new')">
            فعالیت جدید
          </button>
        </div>

        <div class="overflow-hidden" *ngIf="undoneActivities.length > 0">
          <ng-container *ngFor="let item of undoneActivities; let i = index">

            <div class="bg-white p-2 mt-3 border-round">
              <p-panel [toggleable]="true" [collapsed]="true" class="p-0 border-none">

                <ng-template pTemplate="header" style="border:none !important">
                  <div class="flex justify-content-between align-items-center w-full">
                    <p class="m-0">{{item.title}}</p>

                    <button *ngIf="item.comments?.length > 0"
                            pButton
                            class="p-button-rounded p-button-text p-button-sm  text-color-secondary font-bold p-2"
                            [class]="openedUndoneCommentIndex === i ? 'pi pi-minus' : 'pi pi-plus'"
                            (click)="toggleUndoneComments(i)">
                    </button>

                  </div>
                </ng-template>

              </p-panel>

              <div class="flex gap-3">
                <div class="flex align-items-center gap-2 cursor-pointer border-round-3xl px-3 border-2 border-solid bg-purple-500 text-white px-1"
                     (click)="onDownloadFiles(attachment)"
                     *ngFor="let attachment of item.attachments"
                     pTooltip="دانلود فایل"
                     tooltipPosition="top">
                  <i class="pi pi-download"></i>
                  <p class="m-0 font-light">{{attachment.title}}</p>
                </div>
              </div>
              <div class="flex justify-content-between align-items-center my-2">

                <p class="text-xs text-gray-400 font-italic font-light m-0">
                  ایجاد شده توسط
                  {{item?.assignedUser?.fullName}}
                  زمان برنامه ریزی شده
                  {{item?.dueDate | jalaliDate: 'custom':'HH:mm - YYYY/MM/DD'}}
                </p>

                <div class="flex gap-2">

                  <div (click)="onShowExpertActivityModal(item.id)"
                       class="flex justify-content-center align-items-center hover:bg-pink-400 border-round p-2 cursor-pointer hover:text-white"
                       pTooltip="تغییر کارشناس"
                       tooltipPosition="top">
                    <i class="pi pi-user text-pink-600 text-lg"></i>
                  </div>


                  <!--                  onShowModalEditActivity(item.id, 'edit')-->
                  <div (click)="onClickEditActivity(item.id)"
                       class="flex justify-content-center align-items-center hover:bg-green-400 border-round p-2 cursor-pointer hover:text-white"
                       pTooltip="ویرایش"
                       tooltipPosition="top">
                    <i class="pi pi-file-edit text-green-600 text-lg"></i>
                  </div>

                  <div (click)="doneActivityModal(item.id)"
                       class="flex justify-content-center align-items-center hover:bg-purple-400 border-round p-2 cursor-pointer hover:text-white"
                       pTooltip="فعالیت انجام شد"
                       tooltipPosition="top">
                    <i class="pi pi-check text-purple-600 text-lg"></i>
                  </div>

                  <div (click)="onOpenCommentModal(item.id)"
                       class="flex justify-content-center align-items-center hover:bg-orange-400 border-round p-2 cursor-pointer hover:text-white"
                       pTooltip="ثبت نظر"
                       tooltipPosition="top">
                    <i class="pi pi-book text-orange-600 text-lg"></i>
                  </div>

                  <div (click)="deleteItemActiviy(item.id)"
                       class="flex justify-content-center align-items-center hover:bg-red-400 border-round p-2 cursor-pointer hover:text-white"
                       pTooltip="حذف"
                       tooltipPosition="top">
                    <i class="pi pi-trash danger text-red-600 text-lg"></i>
                  </div>
                </div>

              </div>

            </div>

            <div *ngIf="openedUndoneCommentIndex === i">
              <div class="border-1 p-2 border-gray-300 border-round my-2 mr-5" style="background:#f0fda8" *ngFor="let comment of item.comments">
                <p [innerHTML]="sanitizeContent(comment.content)"></p>
                <div class="flex">
                  <p class="text-xs text-gray-400 font-italic font-light">ایجاد شده توسط {{comment?.user?.fullName}}</p>
                </div>
              </div>
            </div>

          </ng-container>
        </div>

        <div *ngIf="undoneActivities.length == 0" class="flex align-items-center justify-content-center bg-white border-round my-3 py-7 overflow-hidden">
          <img src="assets/images/Frame2.png" alt="" style="width:140px">
          <div class="block text-orange-400">
            <p class="mb-2">هیچ فعالیتی برای این معامله برنامه ریزی نکردی!</p>
            <p class="m-0">برای اینکه از دستش ندهی یک فعالیت برایش تعریف کن.</p>
          </div>

        </div>

      </div>

    </div>

    <div class="scroll-container" (scroll)="onScrollContainer($event)">

      <!-- begin activities section -->
      <ng-container *ngIf="activeItem == 'activities'">

        <div class="flex justify-content-center">
          <span class="m-0 font-light text-white px-5 border-round mt-5 text-sm py-2"
                style="background: #808080">تاریخچه</span>
        </div>

        <div *ngFor="let item of doneActivities; let i = index">

          <div class="bg-white p-2 mt-3 border-round">
            <p-panel [toggleable]="true" [collapsed]="true" class="p-0 border-none">

              <ng-template pTemplate="header" style="border:none !important">
                <div class="flex justify-content-between align-items-center w-full">
                  <p class="m-0">{{item.title}}</p>

                  <button *ngIf="item.comments?.length > 0"
                          pButton
                          class="p-button-rounded p-button-text p-button-sm  text-color-secondary font-bold p-2"
                          [class]="openedDoneCommentIndex === i ? 'pi pi-minus' : 'pi pi-plus'"
                          (click)="toggleDoneComments(i)">
                  </button>
                </div>
              </ng-template>

            </p-panel>

            <div class="flex gap-3">
              <div class="flex align-items-center gap-2 cursor-pointer border-round-3xl border-2 px-3 border-solid bg-purple-500 text-white px-1"
                   (click)="onDownloadFiles(attachment)"
                   *ngFor="let attachment of item.attachments"
                   pTooltip="دانلود فایل"
                   tooltipPosition="top">
                <i class="pi pi-download"></i>
                <p class="m-0 font-light">{{attachment.title}}</p>
              </div>
            </div>

            <div class="flex justify-content-between align-items-center my-2">
              <p class="text-xs text-gray-400 font-italic font-light m-0">
                ایجاد شده توسط {{item?.user?.fullName}}
              </p>

              <div class="flex gap-3">

                <div (click)="onClickHistoryActivity(item.id)"
                     class="flex justify-content-center align-items-center hover:bg-green-400 border-round p-2 cursor-pointer hover:text-white"
                     pTooltip="مشاهد جزییات فعالیت"
                     tooltipPosition="top">
                  <i class="pi pi-eye text-green-600 text-lg"></i>
                </div>

                <div *ngIf="item.doneDate" (click)="onResultActivity(item)"
                     class="flex justify-content-end align-items-center hover:bg-purple-400 border-round p-2 cursor-pointer hover:text-white"
                     pTooltip="نتیجه فعالیت انجام شده"
                     tooltipPosition="top">
                  <i class="pi pi-megaphone text-purple-600 text-lg ml-2"></i>
                </div>

                <div (click)="onOpenCommentModal(item.id)"
                     class="flex justify-content-end align-items-center hover:bg-orange-400 border-round p-2 cursor-pointer hover:text-white"
                     pTooltip="ثبت نظر"
                     tooltipPosition="top">
                  <i class="pi pi-book text-orange-600 text-lg"></i>
                </div>

                <div (click)="deleteItemActiviy(item.id)"
                     class="flex justify-content-end align-items-center hover:bg-red-400 border-round p-2 cursor-pointer hover:text-white"
                     pTooltip="حذف"
                     tooltipPosition="top">
                  <i class="pi pi-trash danger text-red-600 text-lg"></i>
                </div>

              </div>

            </div>

            <div pTooltip="نتیجه فعالیت"
                 tooltipPosition="top"
                 *ngIf="item.result"
                 class="bg-gray-200 px-2 py-1 mx-3 border-round">
              {{item.result}}
            </div>

          </div>



          <div *ngIf="openedDoneCommentIndex === i">
            <div class="border-1 p-2 border-gray-300 border-round my-2 mr-5" style="background:#f0fda8" *ngFor="let comment of item.comments">
              <p [innerHTML]="sanitizeContent(comment.content)"></p>
              <div class="flex">
                <p class="text-xs text-gray-400 font-italic font-light">ایجاد شده توسط {{comment?.user?.fullName}}</p>
              </div>
            </div>
          </div>
          <!--              <div class="p-card p-3 mt-2">-->

          <!--                <p>{{item.title}}</p>-->
          <!--                <div class="flex justify-content-between align-items-center">-->
          <!--                  <p class="text-xs text-gray-400 font-italic font-light">ایجاد شده توسط {{item?.user?.fullName}}</p>-->
          <!--                  <button (click)="op.toggle($event)" pButton pRipple icon="pi pi-ellipsis-h" class="p-button-rounded p-button-info p-mr-2 m-1"></button>-->

          <!--                </div>-->
          <!--                <p-overlayPanel #op>-->
          <!--                  <div class="flex flex-column gap-3 w-10rem">-->

          <!--                    <div (click)="onShowModalEditActivity(item.id, 'edit')" class="flex justify-content-end align-items-center hover:bg-green-400 border-round p-2 cursor-pointer hover:text-white">-->
          <!--                      <span class="hover:text-white">ویرایش</span>-->
          <!--                      <i class="pi pi-eye text-green-600 ml-2"></i>-->
          <!--                    </div>-->

          <!--                    <div (click)="onOpenCommentModal(item.id)" class="flex justify-content-end align-items-center hover:bg-orange-400 border-round p-2 cursor-pointer hover:text-white">-->
          <!--                      ثبت  نظر-->
          <!--                      <i class="pi pi-book text-orange-600 ml-2"></i>-->
          <!--                    </div>-->

          <!--                    <div (click)="deleteItemActiviy(item.id)" class="flex justify-content-end align-items-center hover:bg-red-400 border-round p-2 cursor-pointer hover:text-white">-->
          <!--                      حذف-->
          <!--                      <i class="pi pi-trash danger text-red-600 ml-2"></i>-->
          <!--                    </div>-->

          <!--                  </div>-->
          <!--                </p-overlayPanel>-->
          <!--              </div>-->



        </div>
      </ng-container>

      <!-- begin notes section -->
      <ng-container *ngIf="activeItem == 'notes'">

        <div class="flex justify-content-center mt-5 relative">
          <span class="m-0 font-light text-white px-5 border-round text-sm py-2"
                style="background: #808080">تاریخچه</span>
          <span class="m-0 font-light text-base p-2 border-round text-sm cursor-pointer absolute left-0 bg-gray-300"
                (click)="toggleSort()"
                [class]="sortAscending ? 'pi pi-sort-amount-up' : 'pi pi-sort-amount-down-alt'"></span>
        </div>

        <div class="p-card p-3 mt-2 relative note-card" style="background:#f0fda8" *ngFor="let item of noteData">

          <div class="absolute pin-icon cursor-pointer"
               [style]="{opacity: item.pinned ? '1' : '0', rotate: item.pinned ? '315deg' : '' }"
               style="left:5px; top:5px" (click)="changeNotePinState(item)">
            <img src="./assets/images/pin-25.png" style="width:20px" alt="">
          </div>

          <p [innerHTML]="sanitizeContent(item.content)"></p>

          <div class="flex gap-3">
            <div (click)="onDownloadFiles(attachment)"
                 class="flex gap-2 bg-orange-500 p-2 border-round text-white cursor-pointer"
                 *ngFor="let attachment of item.attachments"
                 pTooltip="دانلود فایل"
                 tooltipPosition="top">
              <i class="pi pi-download"></i>
              <p>{{attachment.title}}</p>
            </div>
          </div>

          <div class="flex justify-content-between align-items-center">

            <p class="text-xs text-gray-400 font-italic font-light m-0">ایجاد شده توسط {{item?.user ? item?.user?.fullName : item.thirdPartyEmployeeFullName}}</p>
            <!--            <button (click)="opl.toggle($event)" pButton pRipple icon="pi pi-ellipsis-h" class="p-button-rounded p-button-info p-mr-2 m-1"></button>-->

            <div class="flex gap-2">
              <div (click)="onShowModalEditNote(item.id, 'edit')"
                   class="flex justify-content-end align-items-center hover:bg-green-400 border-round p-2 cursor-pointer hover:text-white"
                   pTooltip="ویرایش"
                   tooltipPosition="top">
                <i class="pi pi-eye text-green-600 text-lg"></i>
              </div>

              <div (click)="deleteItemNote(item.id)"
                   class="flex justify-content-end align-items-center hover:bg-red-400 border-round p-2 cursor-pointer hover:text-white"
                   pTooltip="حذف"
                   tooltipPosition="top">
                <i class="pi pi-trash danger text-red-600 text-lg"></i>
              </div>
            </div>

          </div>

          <!--          <p-overlayPanel #opl>-->
          <!--            <div class="flex flex-column gap-3 w-10rem">-->

          <!--              <div (click)="onShowModalEditNote(item.id, 'edit')" class="flex justify-content-end align-items-center hover:bg-green-400 border-round p-2 cursor-pointer hover:text-white">-->
          <!--                <span class="hover:text-white">ویرایش</span>-->
          <!--                <i class="pi pi-eye text-green-600 ml-2"></i>-->
          <!--              </div>-->

          <!--              <div (click)="deleteItemNote(item.id)" class="flex justify-content-end align-items-center hover:bg-red-400 border-round p-2 cursor-pointer hover:text-white">-->
          <!--                حذف-->
          <!--                <i class="pi pi-trash danger text-red-600 ml-2"></i>-->
          <!--              </div>-->

          <!--            </div>-->
          <!--          </p-overlayPanel>-->

        </div>
      </ng-container>

      <!-- begin changeLog section -->
      <ng-container *ngIf="activeItem == 'changeLog'">

        <div class="flex justify-content-center">
          <span class="font-light text-white px-5 border-round mt-2 text-sm py-2"
                style="background: #808080">تاریخچه تغییرات</span>
        </div>

        <div class="flex flex-column align-items-center">
          <div class="flex gap-1 border-1 border-dashed border-round border-gray-400 bg-teal-100 p-2 mt-3 w-6" *ngFor="let log of changeLog; let i=index" style="font-size:12px">
            <span class=" font-light font-italic">{{WorkItemChangeLogTypesEnum2LableMapping[log.logType]}}</span>
            <span class="font-light">به
              <em class="font-light font-italicf font-bold ">{{log.description}}</em>
            </span>
            <span class="font-light">توسط</span>
            <span class="font-light font-italic">{{log.changeUser.fullName}}</span>
            <span class="font-light">در تاریخ</span>
            <span class="font-light font-italic">{{log.dateTime | jalaliDate}}</span>
          </div>
        </div>


      </ng-container>

      <!-- begin sendMessages -->
      <ng-container *ngIf="activeItem == 'sendMessage'">

        <div class="flex justify-content-center">
          <span class="font-light text-white px-5 border-round mt-2 text-sm py-2"
                style="background: #808080">تاریخچه پیام های ارسالی</span>
        </div>

        <div class="grid" *ngIf="workItem && workItem.messages.length > 0">
          <ng-container *ngFor="let message of workItem.messages; let i=index">
            <div class="col-2"></div>
            <div class="co-10"></div>
          </ng-container>

        </div>

        <div class="flex flex-column align-items-center">
          <div class="flex flex-column align-items-start gap-1 border-1 border-dashed border-round border-gray-200 py-3 mt-3 w-6 bg-whatsapp">

            <div class="chat-container">
              <!-- پیام خود کاربر -->
              <div class="chat-message sent grid align-items-end"
                   *ngFor="let message of workItem.messages; let i=index">
                <div class="col-1 flex justify-content-center">
                  <span class="pi pi-user p-avatar-icon avatar" [pTooltip]="message?.currentUser?.fullName"
                        tooltipPosition="right"></span>
                </div>

                <div class="col-11">
                  <div [pTooltip]="message.phoneNumber"
                       tooltipPosition="left">
                    <!--                  <p class="m-0 text-left text-xs text-color-secondary">0915</p>-->
                    <div class="bubble">
                      <p class="text">{{message.message}}</p>
                      <span class="time">
                      <ng-container *ngIf="message.sendWasSuccessful; else pendingIcon">
                      <i class="pi pi-check text-blue-400 ml-1"></i>
                    </ng-container>
                      <span class="text-nowrap">{{message.sendWasSuccessful ? (message.lastSend | jalaliDate:'hour') : ''}}</span>
                    </span>

                      <ng-template #pendingIcon>
                        <img src="assets/images/exclamation-25.png" alt=""
                             class="ml-1"
                             style="width:17px"
                             pTooltip="ارسال نشد"
                             tooltipPosition="top">
                      </ng-template>
                    </div>
                  </div>
                </div>



              </div>

            </div>

          </div>
        </div>



      </ng-container>

    </div>

  </div>
</div>


<!--************************** begin Comment modal *************************************-->
<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showCommentModal"
  [appendTo]="'body'"
  header="ثبت نظر"
  [modal]="true">

  <div class="grid">
    <div class="col-12">

      <div class="form-group mt-3">
        <div class="field">
          <p-editor [(ngModel)]="newComment" [style]="{ height: '320px' }" [styleClass]="'rtl-editor'" />
        </div>
      </div>

    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      label="ثبت"
      class="p-button-success p-mr-2"
      (click)="onNewCommnet()"></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="onCloseCommentModal()"
    ></button>
  </ng-template>

</p-dialog>
<!--************************** end Comment modal *************************************-->

<!--************************** begin Result Activity modal *************************************-->
<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showResultActivityModal"
  [appendTo]="'body'"
  header="نتیجه فعالیت"
  [modal]="true">

  <div class="grid">
    <div class="col-12">
      <p>{{showResult}}</p>
    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      label="تایید"
      class="p-button-success p-mr-2"
      (click)="showResultActivityModal = false"></button>
  </ng-template>

</p-dialog>
<!--************************** end Result Activity modal *************************************-->

<!-- ************************** begin new-activity modal ************************************* -->
<!--<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showModalNewActivity"
  [appendTo]="'body'"
  [header]="modalState  == 'new' ? 'افزودن فعالیت جدید' : 'ویرایش فعالیت'"
  [modal]="true"
  [closable]="false">

  <div class="grid">

    <div class="col-12">

      <ul class="flex flex-wrap list-none p-0">
        <li *ngFor="let item of activityList; let i = index"
            [class]="{ 'green-bg': selectedIndex === i }"
            (click)="onSetValue(item,i)"
            class="border-1 border-gray-500 py-2 px-3 m-2 cursor-pointer border-radius-3 flex align-items-center">
          <span [class]="item.iconClass" class="text-lg"></span>
        </li>

      </ul>

      <div class="form-group">
        <label class="font-bold text-900">عنوان </label>
        <div class="field">
          <input
            pInputText
            type="text"
            id="title"
            name="title"
            class="p-fieldset w-full"
            placeholder="عنوان فعالیت خود را وارد نمایید"
            [(ngModel)]="newActivity.title">
        </div>
      </div>

    </div>

    <div class="col-12 flex flex-wrap gap-3">

      <div class="datePickerContainer relative">
        <label class="text-right font-bold text-md mb-2" for="startDate">تاریخ</label>
        <ng-persian-datepicker
          [style]="{'width':'220px'}"
          (dateOnSelect)="selectStartDate($event)"
          (dateOnInit)="initialStartDatePicker($event)"
          [dateGregorianFormat]="'YYYY-MM-DD '"
          [dateFormat]="'YYYY-MM-DD '">
          <input [formControl]="startDateTimeControl" id="startDate" name="startDate" class="font-bold w-full" pInputText type="text" autocomplete="off"/>
        </ng-persian-datepicker>
      </div>

      <div class="datePickerContainer relative">
        <label class="text-right font-bold text-md mb-2" for="startDate">ساعت</label>
        <div>
          <p-dropdown
            [styleClass]="'clear-icon'"
            [showClear]="true"
            [options]="hourTime"
            [(ngModel)]="selectedHourTime"
            class="mt-2"
            [style]="{'width':'155px'}"
            placeholder="ساعت">
          </p-dropdown>
        </div>
      </div>

      <div class="datePickerContainer relative">
        <label class="text-right font-bold text-md mb-2" for="startDate">دقیقه</label>
        <div>
          <p-dropdown
            [styleClass]="'clear-icon'"
            [showClear]="true"
            [options]="minuteTime"
            [(ngModel)]="selectedMinuteTime"
            class="mt-2"
            [style]="{'width':'155px'}"
            placeholder="دقیقه">
          </p-dropdown>
        </div>
      </div>

      <div class="form-group">
        <label class="text-right font-bold text-md mb-2">مدت انجام فعالیت </label>
        <div class="field">
          <input
            pInputText
            type="text"
            id="defaultDuration"
            name="defaultDuration"
            class="p-fieldset"
            placeholder="مدت انجام فعالیت را وارد نمایید"
            [style]="{'width':'155px'}"
            [(ngModel)]="newActivity.duration"
            [pKeyFilter]="'num'">
        </div>
      </div>

      <div class="form-group">
        <label class="text-right font-bold text-md mb-2">
          <i class="pi pi-bell"></i>
          افزودن یادآور برای فعالیت
          <span *ngIf="!shouldShowReminderFields()"
                class="text-red-500 font-bold">
            <i class="pi pi-question-circle" pTooltip="زمانی که انتخاب میکنید می بایست جلو تر از زمان فعلی باشد" tooltipPosition="top" placeholder="Top"></i>
          </span>
        </label>
        <ng-container *ngIf="shouldShowReminderFields()">
          <div *ngFor="let item of reminders; let i = index;let last = last" class="field flex align-items-baseline gap-4">
            <button type="button" [disabled]="isReminderDisabled"
                    [style]="{'cursor': isReminderDisabled ? 'no-drop' : ''}"
                    (click)="deleteReminder(i)"
                    class="p-button p-button-danger p-button-sm border-round-3xl p-2 pi pi-times"></button>
            <input
              pInputText
              type="text"
              id="reminder"
              name="reminder"
              class="p-fieldset"
              placeholder="مدت زمان"
              [style]="{'width':'150px'}"
              [(ngModel)]="item.value"
              [pKeyFilter]="'int'"
              [disabled]="isReminderDisabled">
            <p-dropdown
              [styleClass]="'clear-icon'"
              [showClear]="true"
              [options]="TimeUnits"
              [(ngModel)]="item.periodTimeUnit"
              optionLabel="title"
              optionValue="value"
              class="mt-2"
              [style]="{'width':'150px'}"
              [required]="true"
              placeholder="دقیقه | ساعت | روز"
              [disabled]="isReminderDisabled">
            </p-dropdown>
            <button type="button" *ngIf="last && !isReminderDisabled" (click)="addReminder()"
                    class="p-button p-button-success border-round-3xl p-2 p-button-sm pi pi-plus cursor-pointer"></button>
          </div>
        </ng-container>
      </div>

    </div>

    <div class="col-12">
      <app-upload-file #uploadFileComponent [multi]="true" [initialAttachments]="newActivity.attachments" (photos)="changeMainPhoto($event)" [addLabel]="'پیوست'"></app-upload-file>
    </div>

    <div class="col-12">

      <div class="form-group" *ngIf="user.userType === UserTypesEnum.Admin || user.userType === UserTypesEnum.SuperAdmin">
        <label class="font-bold text-900">مسئول اتجام این فعالیت </label>
        <div class="field">
          <p-dropdown
            [styleClass]="'clear-icon'"
            [showClear]="true"
            [disabled]="modalState === 'edit'"
            [options]="userList"
            [(ngModel)]="newActivity.userId"
            optionLabel="fullName"
            optionValue="id"
            class="mt-2"
            [style]="{'width':'100%'}"
            [required]="true"
            placeholder="مسئول انجام فعالیت را انتخاب نمایید">
          </p-dropdown>
        </div>
      </div>

      <div class="form-group font-bold text-orange-500 mb-3">این فعالیت مرتبط است با:</div>

      <div class="field">
        <p-autoComplete
          [inputStyle]="{'width':'100%'}"
          [style]="{'width':'100%'}"
          [suggestions]="filteredCustomer"
          (completeMethod)="filterCustomer($event)"
          (onSelect)="selectedSearchCustomer($event)"
          [(ngModel)]="companyName"
          [disabled]="true"
          [showClear]="true"
          [autofocus]="true"
          [showEmptyMessage]="true"
          emptyMessage="موردی یافت نشد"
          appendTo="body"
          optionLabel="fullName"
          styleClass="w-full mx-auto"
          scrollHeight="400px"
          class="p-autocomplete w-full mx-auto"
          placeholder="نام خانوادگی | شماره تلفن | شرکت">

          <ng-template let-filteredCustomers pTemplate="item">
            <div class="grid align-items-end justify-content-between" style="direction: rtl">


              <div class="col-12 overflow-hidden flex gap-2">
                <p class=" my-0 ">{{filteredCustomers.name}}</p>
                <p
                  class=" my-0 white-space-nowrap overflow-hidden  text-overflow-ellipsis">
                  {{filteredCustomers.family}} ({{filteredCustomers.companyName ? filteredCustomers.companyName :''}})
                </p>
              </div>


            </div>
          </ng-template>

        </p-autoComplete>
      </div>

      <div class="field">
        <p-autoComplete
          [inputStyle]="{'width':'100%'}"
          [style]="{'width':'100%'}"
          [(ngModel)]="workItemTitle"
          [suggestions]="filteredWorkItem"
          (completeMethod)="filterWorkItems($event)"
          (onSelect)="selectedSearchWorkItems($event)"
          [disabled]="true"
          [showClear]="true"
          [autofocus]="true"
          [showEmptyMessage]="true"
          emptyMessage="موردی یافت نشد"
          appendTo="body"
          optionLabel="title"
          styleClass="w-full mx-auto"
          scrollHeight="400px"
          class="p-autocomplete w-full mx-auto"
          placeholder="جستجو براساس قلم کاری | نام شرکت | نام شخص">

          <ng-template let-filteredWorkItems pTemplate="item">
            <div class="grid align-items-end justify-content-between" style="direction: rtl">
              <div class="col-12 overflow-hidden flex gap-2">
                <p class=" my-0 ">{{filteredWorkItems.title}}</p>
              </div>
            </div>
          </ng-template>

        </p-autoComplete>
      </div>

      <div class="form-group">
        <label class="font-bold text-900">توضیحات </label>
        <div class="field">
                <textarea
                  rows="5"
                  [style]="{'width':'100%'}"
                  pInputTextarea
                  placeholder="توضیحات مورد نیاز برای این فعالیت را وارد نمایید"
                  [(ngModel)]="newActivity.description">
              </textarea>
        </div>
      </div>

    </div>

</div>


  <ng-template pTemplate="footer">

    <button
      pButton
      pRipple
      label="تایید"
      class="p-button-success button p-mr-2"
      (click)="onRegisterActivity(modalState)"
    ></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="closePanel()"
    ></button>

  </ng-template>

</p-dialog> -->
<!-- ************************** end new-activity modal ************************************* -->

<!--************************** begin new-note modal *************************************-->
<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showModalNewNote"
  [appendTo]="'body'"
  [header]="modalState === 'new' ? 'افزودن یادداشت جدید' : 'ویرایش یادداشت'"
  [modal]="true"
  [closable]="false">

  <div class="grid">
    <div class="col-12">
      <app-upload-file #uploadFileComponent [multi]="true" [initialAttachments]="newNoteData.attachments" (photos)="changeMainPhoto($event)" [addLabel]="'پیوست'"></app-upload-file>
    </div>
    <div class="col-12">
      <p-editor [(ngModel)]="newNoteData.content" [style]="{ height: '320px' }" [styleClass]="'rtl-editor'" />
    </div>

  </div>


  <ng-template pTemplate="footer">

    <button
      pButton
      pRipple
      label="تایید"
      class="p-button-success button p-mr-2"
      (click)="addNewDescription(modalState)"
    ></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="closePanel()"
    ></button>

  </ng-template>

</p-dialog>
<!--************************** end new-note modal *************************************-->

<!--************************** begin attachment modal *************************************-->
<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showModal"
  [appendTo]="'body'"
  header="افزودن پیوست"
  [modal]="true"
  [closable]="false">

  <div class="grid">
    <div class="col-12">

      <div class="form-group">
        <label class="font-bold text-900">عنوان </label>
        <div class="field mt-2">
          <input
            pInputText
            type="text"
            id="title"
            name="title"
            placeholder="عنوان یادداشت را وارد نمایید"
            class="p-fieldset"
            [style]="{'width':'250px'}"
            [(ngModel)]="newAttachment.title">
        </div>
      </div>

      <div class="mt-3">
        <app-upload-file [fileType]="fileTypeValue" [multi]="false" (photos)="changeMainPhoto($event)"
                         [addLabel]="'بارگذاری'"></app-upload-file>
      </div>

    </div>
  </div>


  <ng-template pTemplate="footer">

    <button
      pButton
      pRipple
      label="تایید"
      class="p-button-success button p-mr-2"
      (click)="addNewAttachement()"
    ></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="resetModal()"
    ></button>

  </ng-template>

</p-dialog>
<!--************************** end attachment modal *************************************-->

<!--************************** begin Done Activity modal *************************************-->
<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showDoneActivityModal"
  [appendTo]="'body'"
  header="نتیجه انجام فعالیت"
  [modal]="true">

  <div class="grid">
    <div class="col-12">
      <div class="form-group mt-3">
        <label class="block mb-2">توضیحات</label>
        <div class="field">
              <textarea
                [(ngModel)]="resultActivity"
                [style]="{'width':'100%'}"
                rows="5"
                id="description"
                name="description"
                pInputTextarea
                placeholder="توضیحات خودرا وارد نمایید."
                class="p-fieldset">
              </textarea>
        </div>
      </div>

    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      label="تایید"
      class="p-button-success p-mr-2"
      (click)="onDoneActivity()"></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="showDoneActivityModal= false"
    ></button>
  </ng-template>

</p-dialog>
<!--************************** end Done Activity modal *************************************-->

<!--************************** begin Change Expert modal *************************************-->
<p-dialog
  [styleClass]="'modal-medium'"
  [style]="{direction:'rtl'}"
  [(visible)]="showChangeExpertModal"
  [appendTo]="'body'"
  header="تغییر کارشناس قلم کاری"
  [closable]="false"
  [modal]="true">

  <div class="grid">
    <div class="col-12">

      <div class="form-group">
        <label class="block mb-2">کارشناس</label>
        <p-dropdown
          [options]="expertUsers"
          [(ngModel)]="selectedExpert"
          [appendTo]="'body'"
          [style]="{'width':'100%'}"
          optionLabel="fullName"
          optionValue="id"
          placeholder ="کارشناس خود را انتخاب نمایید">
        </p-dropdown>
      </div>


    </div>
  </div>

  <ng-template pTemplate="footer">
    <button
      pButton
      pRipple
      label="تایید"
      class="p-button-success p-mr-2"
      (click)="onChangeExpertActivity()"></button>

    <button
      pButton
      pRipple
      label="انصراف"
      class="p-button-danger p-mr-2"
      (click)="onCloseExpertChangeModal()"
    ></button>
  </ng-template>

</p-dialog>
<!--************************** end Change Expert modal *************************************-->

<app-new-activity-modal #newActivityModal
                        [workItemId]="workItemId"
                        [customerId]="customerId"
                        [expertId]="expertId"
                        [userList]="userList"
                        (activityRegistered)="setActive($event)"></app-new-activity-modal>
